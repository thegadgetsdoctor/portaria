<!DOCTYPE html>
<html>
<head>
    <title>Controle de Portaria</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        .form-group { margin-bottom: 10px; }
        button { padding: 8px 12px; cursor: pointer; }
        .tab { overflow: hidden; border: 1px solid #ccc; background-color: #f1f1f1; }
        .tab button { background-color: inherit; border: none; outline: none; cursor: pointer; padding: 10px 16px; }
        .tab button.active { background-color: #ddd; }
        .tabcontent { display: none; padding: 20px 0; }
    </style>
</head>
<body>
    <h1>Controle de Portaria</h1>
    
    <div class="tab">
        <button class="tablinks active" onclick="openTab(event, 'entrada')">Registrar Entrada</button>
        <button class="tablinks" onclick="openTab(event, 'saida')">Registrar Saída</button>
        <button class="tablinks" onclick="openTab(event, 'relatorio')">Relatório</button>
    </div>

    <!-- Aba de Entrada -->
    <div id="entrada" class="tabcontent" style="display: block;">
        <h2>Registrar Entrada</h2>
        <div class="form-group">
            <label>Nome:</label>
            <input type="text" id="nome" required>
        </div>
        <div class="form-group">
            <label>CPF:</label>
            <input type="text" id="cpf">
        </div>
        <div class="form-group">
            <label>Placa do Veículo (opcional):</label>
            <input type="text" id="placa">
        </div>
        <div class="form-group">
            <label>Motivo:</label>
            <select id="motivo">
                <option value="Visita">Visita</option>
                <option value="Entrega">Entrega</option>
                <option value="Serviço">Serviço</option>
            </select>
        </div>
        <div class="form-group">
            <label>Unidade/Responsável:</label>
            <input type="text" id="unidade" required>
        </div>
        <button onclick="registrarEntrada()">Salvar Entrada</button>
    </div>

    <!-- Aba de Saída -->
    <div id="saida" class="tabcontent">
        <h2>Registrar Saída</h2>
        <div class="form-group">
            <label>CPF ou Nome:</label>
            <input type="text" id="buscaSaida" placeholder="Digite para buscar">
        </div>
        <button onclick="buscarVisitante()">Buscar</button>
        <div id="resultadoBusca" style="margin-top: 20px;"></div>
    </div>

    <!-- Aba de Relatório -->
    <div id="relatorio" class="tabcontent">
        <h2>Relatório de Visitas</h2>
        <button onclick="exportarCSV()">Exportar para CSV</button>
        <table id="tabelaRelatorio">
            <thead>
                <tr>
                    <th>Nome</th>
                    <th>CPF</th>
                    <th>Placa</th>
                    <th>Entrada</th>
                    <th>Saída</th>
                    <th>Motivo</th>
                    <th>Unidade</th>
                </tr>
            </thead>
            <tbody id="corpoRelatorio"></tbody>
        </table>
    </div>

    <script>
        // Banco de dados local
        let visitas = JSON.parse(localStorage.getItem('visitas')) || [];

        // Funções das abas
        function openTab(evt, tabName) {
            const tabcontent = document.getElementsByClassName("tabcontent");
            for (let i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            const tablinks = document.getElementsByClassName("tablinks");
            for (let i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
        }

        // Registrar entrada
        function registrarEntrada() {
            const visita = {
                nome: document.getElementById('nome').value,
                cpf: document.getElementById('cpf').value,
                placa: document.getElementById('placa').value,
                motivo: document.getElementById('motivo').value,
                unidade: document.getElementById('unidade').value,
                entrada: new Date().toLocaleString(),
                saida: ""
            };

            visitas.push(visita);
            localStorage.setItem('visitas', JSON.stringify(visitas));
            alert('Entrada registrada com sucesso!');
            document.getElementById('entrada-form').reset();
        }

        // Buscar visitante para saída
        function buscarVisitante() {
            const termo = document.getElementById('buscaSaida').value.toLowerCase();
            const resultados = visitas.filter(v => 
                !v.saida && (v.nome.toLowerCase().includes(termo) || v.cpf.includes(termo))
            );

            let html = '';
            if (resultados.length === 0) {
                html = '<p>Nenhuma visita em aberto encontrada.</p>';
            } else {
                html = '<table><tr><th>Nome</th><th>Entrada</th><th>Ação</th></tr>';
                resultados.forEach((visita, index) => {
                    html += `
                        <tr>
                            <td>${visita.nome}</td>
                            <td>${visita.entrada}</td>
                            <td><button onclick="registrarSaida(${index})">Registrar Saída</button></td>
                        </tr>
                    `;
                });
                html += '</table>';
            }
            document.getElementById('resultadoBusca').innerHTML = html;
        }

        // Registrar saída
        function registrarSaida(index) {
            visitas[index].saida = new Date().toLocaleString();
            localStorage.setItem('visitas', JSON.stringify(visitas));
            alert('Saída registrada com sucesso!');
            buscarVisitante();
            atualizarRelatorio();
        }

        // Atualizar relatório
        function atualizarRelatorio() {
            const corpo = document.getElementById('corpoRelatorio');
            corpo.innerHTML = '';
            visitas.forEach(visita => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${visita.nome}</td>
                    <td>${visita.cpf}</td>
                    <td>${visita.placa}</td>
                    <td>${visita.entrada}</td>
                    <td>${visita.saida || 'Em andamento'}</td>
                    <td>${visita.motivo}</td>
                    <td>${visita.unidade}</td>
                `;
                corpo.appendChild(row);
            });
        }

        // Exportar para CSV
        function exportarCSV() {
            let csv = 'Nome,CPF,Placa,Entrada,Saída,Motivo,Unidade\n';
            visitas.forEach(visita => {
                csv += `"${visita.nome}","${visita.cpf}","${visita.placa}","${visita.entrada}","${visita.saida}","${visita.motivo}","${visita.unidade}"\n`;
            });

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.setAttribute('hidden', '');
            a.setAttribute('href', url);
            a.setAttribute('download', 'visitas_portaria.csv');
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        // Inicializar
        window.onload = atualizarRelatorio;
    </script>
</body>
</html>
